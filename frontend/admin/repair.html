<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏° - ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°‡∏Ñ‡∏∑‡∏ô</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
    body {
        background: linear-gradient(135deg, #dadce6 0%, #e01010 100%);
        min-height: 100vh;
        padding: 20px 0;
        font-family: 'Sarabun', sans-serif;
    }
    .container-custom {
        background: white;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        padding: 30px;
        margin: auto;
        max-width: 95%;
    }
    .header {
        margin-bottom: 30px;
        border-bottom: 2px solid #667eea;
        padding-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .stat-card {
        background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%); /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á/‡∏™‡πâ‡∏° ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° */
        color: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 20px;
    }
</style>
</head>
<body>

<div class="container-custom">
    <div class="header">
        <h1 class="h3"><i class="fas fa-tools me-2"></i> ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÑ‡∏õ‡∏ã‡πà‡∏≠‡∏°</h1>
        <a href="index.html" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-1"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </a>
    </div>

    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stat-card">
                <i class="fas fa-hammer mb-2 fa-2x"></i>
                <div class="h2 font-weight-bold" id="repair-count">0</div>
                <div class="small">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</div>
            </div>
        </div>
        <div class="col-md-9">
             <input type="text" id="search-input" class="form-control form-control-lg mb-3" 
                    placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°..." oninput="searchRepairItems()">
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-hover" id="repairTable">
            <thead style="background-color: #667eea; color: white;">
                <tr>
                    <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                    <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                    <th>Asset Number</th>
                    <th>Serial Number</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th class="text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="repair-list">
                </tbody>
        </table>
    </div>
</div>

<div style="display: none;">
    <span id="usernameDisplay"></span>
    <h2 id="total-items">0</h2>
    <input type="text" id="inventory-search">
    <div id="inventory-list"></div>
    <div id="pagination-container"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="admin-script.js"></script>

<script>
const CONFIG = { API_BASE: `http://${window.location.hostname}:5000` };

async function loadRepairItems() {
    try {
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å API (‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏° CONFIG ‡πÉ‡∏ô admin-script.js)
        const response = await fetch(`${CONFIG.API_BASE}/items?page=1&limit=999`); 
        const data = await response.json();
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ 'Repair' ‡∏´‡∏£‡∏∑‡∏≠ 'Maintenance'
        const itemsInRepair = data.items.filter(item => 
            item.status === 'Repair' || item.status === 'Maintenance'
        );

        document.getElementById('repair-count').textContent = itemsInRepair.length;
        displayRepairTable(itemsInRepair);
    } catch (err) {
        console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏î‡πâ:', err);
    }
}

function displayRepairTable(items) {
    const tbody = document.getElementById('repair-list');
    tbody.innerHTML = '';

    items.forEach((item, index) => {
        const row = `
            <tr>
                <td>${index + 1}</td>
                <td><img src="${CONFIG.API_BASE}/uploads/${item.image_url}" width="50" class="rounded" onerror="this.src='https://via.placeholder.com/50'"></td>
                <td><strong>${item.item_name}</strong></td>
                <td>${item.asset_number || '-'}</td>
                <td>${item.serial_number || '-'}</td>
                <td><span class="badge bg-${item.status === 'Maintenance' ? 'warning' : 'danger'}">${item.status}</span></td>
                <td class="text-center">
                    <button class="btn btn-sm btn-primary" onclick="editItem(${item.item_id})">
                        <i class="fas fa-edit"></i> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°
                    </button>
                </td>
            </tr>`;
        tbody.innerHTML += row;
    });
}

function searchRepairItems() {
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    const rows = document.getElementById('repair-list').querySelectorAll('tr');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

function editItem(itemId) {
    alert('Edit item ' + itemId);
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å loadRepairItems ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î
document.addEventListener('DOMContentLoaded', loadRepairItems);
</script>

</body>
</html>